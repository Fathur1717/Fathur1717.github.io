<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Service - Mikroklimat Monitoring</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* General Styling */
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef0f4;
            display: flex;
            height: 100vh;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 250px;
            background-color: #3d8c40;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        .sidebar .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 20px;
            border-bottom: 1px solid #5a9e5c;
            margin-bottom: 20px;
        }
        /* PERUBAHAN CSS UNTUK LOGO */
        .sidebar .logo .logo-image {
            height: 50px;
            width: auto;
        }
        .sidebar .logo-text {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar nav li a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            text-decoration: none;
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            transition: background-color 0.3s;
        }
        .sidebar nav li a.active, .sidebar nav li a:hover {
            background-color: #66bb6a;
        }
        .sidebar nav li a i {
            width: 25px;
            text-align: center;
            font-size: 1.4rem;
        }

        /* --- Main Content --- */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        /* --- Chat Room Styling --- */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: 95vh; /* Batasi tinggi maksimum */
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .chat-header {
            padding: 15px 20px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            color: #333;
            flex-shrink: 0;
        }
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 20px;
            line-height: 1.4;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .message.ai {
            background-color: #e9e9eb;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        .message.user {
            background-color: #3d8c40;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        .message.ai.typing span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.4s infinite;
        }
        .message.ai.typing span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .message.ai.typing span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        .chat-input-form {
            display: flex;
            padding: 15px;
            border-top: 1px solid #ddd;
            background-color: #f9f9f9;
            flex-shrink: 0;
        }
        .chat-input-form input {
            flex-grow: 1;
            border: 1px solid #ccc;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 1rem;
            margin-right: 10px;
        }
        .chat-input-form button {
            background-color: #3d8c40;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        .chat-input-form button:hover {
            background-color: #317033;
        }
        .chat-input-form input:disabled, .chat-input-form button:disabled {
            background-color: #f0f0f0;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <!-- PERUBAHAN HTML UNTUK LOGO -->
        <div class="logo">
            <img src="logoseco.png" alt="Mikroklimat Logo" class="logo-image">
            <span class="logo-text">Mikroklimat<br>Monitoring</span>
        </div>
        <nav>
            <ul>
                <li><a href="index.html"><i class="fa-solid fa-house-chimney"></i> Pemantauan</a></li>
                <li><a href="nilai-sensor.html"><i class="fa-solid fa-tower-broadcast"></i> Nilai Sensor</a></li>
                <li><a href="#"><i class="fa-solid fa-cog"></i> Pengaturan</a></li>
                <li><a href="cs-chat.html" class="active"><i class="fa-solid fa-headset"></i> Customer Service</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <div class="chat-container">
            <div class="chat-header">
                Customer Service AI
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    Halo! Saya adalah asisten AI Mikroklimat. Tanyakan apa saja tentang status sensor atau data monitoring Anda.
                </div>
            </div>
            <form class="chat-input-form" id="chat-form">
                <input type="text" id="chat-input" placeholder="Ketik pesan Anda di sini..." autocomplete="off">
                <button type="submit" id="send-button">Kirim</button>
            </form>
        </div>
    </main>

    <script>
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');

        let userMessageCount = 0; // Variabel untuk menghitung pesan pengguna

        // --- PUSAT LOGIKA AI ---
        const aiRules = [
            {
                keywords: ['etilen', 'ethylene', 'pematangan', 'busuk'],
                response: 'Level etilen yang tinggi dapat mempercepat pematangan atau pembusukan buah. Saya sarankan untuk memeriksa sistem ventilasi dan pastikan tidak ada buah yang terlalu matang di area sensor. Apakah Anda ingin saya membuat catatan insiden ini?'
            },
            {
                keywords: ['suhu', 'temperatur', 'panas', 'dingin', 'derajat'],
                response: 'Suhu optimal bergantung pada jenis komoditas. Saat ini, suhu tempat adalah 20.3°C dan suhu buah 19.1°C. Anda dapat melihat detailnya di halaman "Pemantauan". Apakah nilai ini dalam rentang aman?'
            },
            {
                keywords: ['kelembapan', 'lembab', 'humidity', 'rh'],
                response: 'Kelembapan saat ini adalah 77.0%. Menjaga kelembapan yang tepat sangat penting untuk mencegah pertumbuhan jamur dan dehidrasi pada produk. Level ini terdeteksi normal.'
            },
            {
                keywords: ['co2', 'karbon dioksida', 'oksigen', 'udara'],
                response: 'Tingkat CO₂ digunakan untuk mengukur kualitas sirkulasi udara. Tingkat yang tinggi bisa menandakan ventilasi yang buruk, yang dapat memengaruhi kualitas produk. Semua data sensor gas dapat dilihat di halaman "Nilai Sensor".'
            },
            {
                keywords: ['laporan', 'report', 'data', 'unduh', 'download', 'ekspor', 'export'],
                response: 'Tentu, saya bisa membantu terkait laporan. Laporan apa yang Anda butuhkan? Laporan harian, mingguan, bulanan, atau laporan insiden spesifik terkait sensor tertentu?'
            },
            {
                keywords: ['sensor', 'alat', 'device', 'perangkat', 'error', 'rusak', 'offline'],
                response: 'Jika ada masalah dengan sensor, coba periksa koneksi fisiknya terlebih dahulu. Sensor mana yang ingin Anda diskusikan? Anda dapat melihat status semua sensor di halaman "Nilai Sensor".'
            },
            {
                keywords: ['siapa kamu', 'anda siapa', 'bot', 'ai'],
                response: 'Saya adalah asisten AI Mikroklimat. Tugas saya adalah membantu Anda memahami data monitoring dan memberikan rekomendasi awal jika ada anomali terdeteksi.'
            },
            {
                keywords: ['bantuan', 'tolong', 'help', 'bingung', 'panduan'],
                response: 'Tentu. Anda bisa bertanya kepada saya tentang: \n- Status spesifik sensor (contoh: "bagaimana kondisi suhu?").\n- Arti dari sebuah pengukuran (contoh: "kenapa etilen penting?").\n- Cara meminta laporan data.'
            },
            {
                keywords: ['halo', 'hai', 'selamat pagi', 'siang', 'sore', 'malam'],
                response: 'Halo! Ada yang bisa saya bantu terkait sistem monitoring mikroklimat Anda hari ini?'
            },
            {
                keywords: ['terima kasih', 'makasih', 'thanks', 'ok', 'baik'],
                response: 'Sama-sama! Jika ada hal lain yang perlu ditanyakan, jangan ragu untuk menghubungi saya lagi.'
            }
        ];
        const defaultResponses = [
            "Maaf, saya tidak yakin mengerti pertanyaan itu. Bisakah Anda menjelaskannya dengan kata kunci yang lebih spesifik seperti 'suhu', 'laporan', atau 'sensor'?",
            "Fokus utama saya adalah data dari sistem monitoring. Coba tanyakan sesuatu yang berhubungan dengan temperatur, kelembapan, CO₂, atau etilen.",
            "Saya masih dalam tahap belajar. Mungkin Anda bisa mencoba bertanya dengan kalimat yang berbeda?"
        ];
        
        function getAiResponse(userMessage) {
            const lowerCaseMessage = userMessage.toLowerCase();
            for (const rule of aiRules) {
                for (const keyword of rule.keywords) {
                    if (lowerCaseMessage.includes(keyword)) {
                        return rule.response;
                    }
                }
            }
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // --- FUNGSI TAMPILAN CHAT ---
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function displayMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            messageDiv.innerHTML = message.replace(/\n/g, '<br>');
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function simulateAiTypingAndResponse(userMessage) {
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('message', 'ai', 'typing');
            typingIndicator.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(typingIndicator);
            scrollToBottom();

            setTimeout(() => {
                chatMessages.removeChild(typingIndicator);
                const aiMessage = getAiResponse(userMessage);
                displayMessage(aiMessage, 'ai');
            }, 1200);
        }

        // Event listener untuk form pengiriman pesan
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMessage = chatInput.value.trim();
            if (userMessage === '' || chatInput.disabled) return;

            displayMessage(userMessage, 'user');
            chatInput.value = '';
            userMessageCount++;

            if (userMessageCount === 3) {
                const specialMessage = "Jika ingin Lebih Jauh, Doakan Kami menang agar bisa berdampak positive bagi pertanian indonesia!!! Love You <3";

                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('message', 'ai', 'typing');
                typingIndicator.innerHTML = '<span></span><span></span><span></span>';
                chatMessages.appendChild(typingIndicator);
                scrollToBottom();

                setTimeout(() => {
                    chatMessages.removeChild(typingIndicator);
                    displayMessage(specialMessage, 'ai');
                    
                    chatInput.disabled = true;
                    chatInput.placeholder = "Terima kasih atas dukungannya!";
                    sendButton.disabled = true;
                }, 1500);

            } else {
                simulateAiTypingAndResponse(userMessage);
            }
        });
    </script>
</body>
</html>